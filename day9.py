#!/usr/bin/env python3
# https://adventofcode.com/2025/day/9


from functools import lru_cache
from collections import deque


def q1(coords):
    coords = [tuple(int(n) for n in line.split(",")) for line in coords]
    max_area = 0
    for i, p1 in enumerate(coords):
        for p2 in coords[i + 1 :]:
            area = abs(p1[0] - p2[0] + 1) * abs(p1[1] - p2[1] + 1)
            if area > max_area:
                max_area = area
    return max_area


lobound = hibound = edges = None
def q2_doesnt_work_written_by_me(coords):
    coords = [tuple(int(n) for n in line.split(",")) for line in coords]

    rects = []
    for i, p1 in enumerate(coords):
        for p2 in coords[i + 1 :]:
            tl = min(p1[0], p2[0]), min(p1[1], p2[1])
            br = max(p1[0], p2[0]), max(p1[1], p2[1])
            rects.append(((br[0] - tl[0] + 1) * (br[1] - tl[1] + 1), tl, br))
    rects = sorted(rects)

    # define largest rectangle that bounds the pattern â€” any path to any edge means the start point is not inside the pattern
    # build set of edges â€” left/right and up/down
    # for each possible rectangle, take a random point inside and see if there is any path to any edge. If so, add all points on that path to a set 'outside'
    # before calculating the path to outside, see if there are any points in the set 'outside' that are inside the rectangle. If so, the rectangle fails
    global lobound; lobound = min([p[0] for p in coords]), min([p[1] for p in coords])
    global hibound; hibound = max([p[0] for p in coords]), max([p[1] for p in coords])
    global edges; edges = []
    for i, p1 in enumerate(coords):
        if i == len(coords) - 1:
            p2 = coords[0]
        else:
            p2 = coords[i + 1]
        edges.append((p1, p2))
    edges = tuple(edges)

    # binary search through rectangles, test each contained square (memoized)
    mn, mx = 0, len(rects) - 1 # mn always good, mx always bad
    if red_green(rects[mx][1], rects[mx][2]):
        return rects[mx][0]
    if not red_green(rects[0][1], rects[0][2]):
        raise Exception("none are good")

    while True:
        i = mn + (mx - mn) // 2
        tl, br = rects[i][1], rects[i][2]
        print(f"binary search {tl}-{br} @{i} between {mn}-{mx}")
        good = red_green(tl, br)

        if good:
            mn = i
        else:
            mx = i

        if mx == mn + 1:
            print(f"  binary search completed @{mn} => {rects[mn]} ({mn=}, {mx=})")
            return rects[mn][0]


known_paths_to_any_edge = set()
def red_green(tl, br):
    if any(tl[0] <= p[0] <= br[0] and tl[1] <= p[1] <= br[1] for p in known_paths_to_any_edge):
        # print(f"rejecting {tl}-{br}, matches known_paths_to_any_edge ({len(known_paths_to_any_edge)})")
        return False

    q = deque()
    q.append((tl[0]+1, tl[1]+1))
    return path_to_edge(q, [q[0]])


def path_to_edge(q, path):
    while q:
        p = q.popleft()

        if p in known_paths_to_any_edge:
            print(f"  rejecting {p}, matches known_paths_to_edge")
            known_paths_to_any_edge.update(path)
            return True

        # if it's on an edge, no!
        if on_edge(p):
            continue

        # if it's on the bounds, yes!
        if p[0] == lobound[0] or p[0] == hibound[0] or p[1] == lobound[1] or p[1] == hibound[1]:
            print(f"  rejecting {p}, hit bounds")
            known_paths_to_any_edge.update(path)
            return True

        # otherwise, recurse left, right, up, down
        q.append((p[0]-1, p[1]))
        q.append((p[0]+1, p[1]))
        q.append((p[0], p[1]-1))
        q.append((p[0], p[1]+1))
    return False


def on_edge(p):
    return any(
        (
            p[0] == edge[0][0] and (edge[0][1] <= p[1] <= edge[1][1])
        ) or (
            p[1] == edge[0][1] and (edge[0][0] <= p[0] <= edge[1][0])
        ) for edge in edges)


# https://www.reddit.com/r/adventofcode/comments/1phywvn/comment/nt995wd/?utm_source=share&utm_medium=web3x&utm_name=web3xcss&utm_term=1&utm_content=share_button
def q2(coords):
    corners = [tuple(map(int, line.split(","))) for line in coords]

    n = len(corners)

    def get_size(x1, y1, x2, y2):
        x = abs(x1 - x2) + 1
        y = abs(y1 - y2) + 1
        return x * y

    edges = []
    sizes = []
    for i in range(n):
        edges.append(sorted((corners[i], corners[i-1])))
        for j in range(i+1, n):
            c1, c2 = sorted((corners[i], corners[j]))
            sizes.append((get_size(*c1, *c2), c1, c2))

    edges.sort(reverse=True, key=lambda e: get_size(*e[0], *e[1]))
    sizes.sort(reverse=True)

    for size, (x1, y1), (x2, y2) in sizes:
        y1, y2 = sorted((y1, y2))
        if not any(
            (x4 > x1 and x3 < x2 and y4 > y1 and y3 < y2)
            for (x3, y3), (x4, y4) in edges
        ):
            return size


sample_input = """7,1
11,1
11,7
9,7
9,5
2,5
2,3
7,3"""


real_input = """98241,50245
98241,51464
98122,51464
98122,52660
97649,52660
97649,53867
97585,53867
97585,55104
97774,55104
97774,56255
97196,56255
97196,57546
97636,57546
97636,58780
97591,58780
97591,59958
97238,59958
97238,61063
96596,61063
96596,62184
96091,62184
96091,63423
96024,63423
96024,64739
96152,64739
96152,65592
94869,65592
94869,66846
94784,66846
94784,67925
94219,67925
94219,69237
94206,69237
94206,70195
93369,70195
93369,71228
92725,71228
92725,72421
92396,72421
92396,73353
91573,73353
91573,74531
91190,74531
91190,75402
90295,75402
90295,76446
89686,76446
89686,77385
88921,77385
88921,78413
88284,78413
88284,79671
87931,79671
87931,80568
87102,80568
87102,81220
85994,81220
85994,82478
85581,82478
85581,83480
84863,83480
84863,83949
83605,83949
83605,84603
82559,84603
82559,85593
81829,85593
81829,86686
81171,86686
81171,87253
80061,87253
80061,87969
79082,87969
79082,88669
78093,88669
78093,89502
77196,89502
77196,90250
76233,90250
76233,91130
75347,91130
75347,91250
74000,91250
74000,92327
73212,92327
73212,92894
72128,92894
72128,93270
70952,93270
70952,93370
69660,93370
69660,94478
68819,94478
68819,94708
67595,94708
67595,95183
66472,95183
66472,95207
65195,95207
65195,96147
64221,96147
64221,96615
63081,96615
63081,96461
61777,96461
61777,97201
60700,97201
60700,97015
59412,97015
59412,97740
58305,97740
58305,97562
57038,97562
57038,97176
55764,97176
55764,97302
54566,97302
54566,97656
53385,97656
53385,98146
52195,98146
52195,97889
50969,97889
50969,97871
49756,97871
49756,97859
48543,97859
48543,97449
47351,97449
47351,97738
46119,97738
46119,97642
44909,97642
44909,97226
43740,97226
43740,97219
42519,97219
42519,96788
41367,96788
41367,97309
40026,97309
40026,96882
38868,96882
38868,96221
37780,96221
37780,95804
36640,95804
36640,96136
35265,96136
35265,95792
34086,95792
34086,94892
33112,94892
33112,94733
31866,94733
31866,94172
30777,94172
30777,93317
29828,93317
29828,92857
28705,92857
28705,92156
27705,92156
27705,91484
26696,91484
26696,91543
25258,91543
25258,90924
24200,90924
24200,90213
23201,90213
23201,89043
22528,89043
22528,88927
21108,88927
21108,88089
20204,88089
20204,87315
19255,87315
19255,86250
18557,86250
18557,85773
17347,85773
17347,84679
16696,84679
16696,83809
15843,83809
15843,82679
15268,82679
15268,82055
14153,82055
14153,81303
13157,81303
13157,80213
12558,80213
12558,79102
12004,79102
12004,78475
10804,78475
10804,76971
10824,76971
10824,76102
9952,76102
9952,75038
9369,75038
9369,74238
8339,74238
8339,72905
8231,72905
8231,71987
7378,71987
7378,70721
7205,70721
7205,69997
5885,69997
5885,68793
5582,68793
5582,67760
4871,67760
4871,66522
4679,66522
4679,65214
4737,65214
4737,64207
3895,64207
3895,62932
3915,62932
3915,61848
3259,61848
3259,60571
3366,60571
3366,59436
2864,59436
2864,58155
3122,58155
3122,57084
2124,57084
2124,55838
2213,55838
2213,54652
1807,54652
1807,53424
1794,53424
1794,52197
1810,52197
1810,50973
1890,50973
1890,50228
94822,50228
94822,48525
1557,48525
1557,47341
2383,47341
2383,46107
2110,46107
2110,44867
1961,44867
1961,43734
2727,43734
2727,42467
2452,42467
2452,41283
2754,41283
2754,40077
2933,40077
2933,38872
3134,38872
3134,37713
3522,37713
3522,36439
3506,36439
3506,35262
3852,35262
3852,34252
4684,34252
4684,33262
5505,33262
5505,32101
5846,32101
5846,31022
6392,31022
6392,29688
6381,29688
6381,28480
6689,28480
6689,27621
7685,27621
7685,26247
7715,26247
7715,25643
9102,25643
9102,24398
9389,24398
9389,23514
10255,23514
10255,22573
11021,22573
11021,21166
11150,21166
11150,20538
12337,20538
12337,19792
13336,19792
13336,18451
13627,18451
13627,17941
14878,17941
14878,16560
15179,16560
15179,15977
16322,15977
16322,14917
16989,14917
16989,14500
18254,14500
18254,13050
18605,13050
18605,12768
19956,12768
19956,11585
20576,11585
20576,11164
21786,11164
21786,10359
22708,10359
22708,9858
23836,9858
23836,8777
24596,8777
24596,8258
25713,8258
25713,7978
26955,7978
26955,7540
28095,7540
28095,6507
28940,6507
28940,6682
30363,6682
30363,6251
31489,6251
31489,5782
32598,5782
32598,4548
33429,4548
33429,4750
34790,4750
34790,4015
35829,4015
35829,4049
37104,4049
37104,3690
38261,3690
38261,2708
39279,2708
39279,3314
40653,3314
40653,2568
41748,2568
41748,2300
42941,2300
42941,2002
44135,2002
44135,2479
45412,2479
45412,1845
46579,1845
46579,2346
47826,2346
47826,2049
49029,2049
49029,2462
50242,2462
50242,2326
51451,2326
51451,1711
52695,1711
52695,1956
53904,1956
53904,1808
55148,1808
55148,2309
56320,2309
56320,3006
57444,3006
57444,3165
58640,3165
58640,3456
59812,3456
59812,3478
61045,3478
61045,3412
62316,3412
62316,4049
63401,4049
63401,4368
64572,4368
64572,4266
65892,4266
65892,5403
66775,5403
66775,5880
67884,5880
67884,6132
69090,6132
69090,6792
70119,6792
70119,6784
71472,6784
71472,7784
72326,7784
72326,8026
73577,8026
73577,8876
74490,8876
74490,8978
75860,8978
75860,9930
76701,9930
76701,10352
77896,10352
77896,11232
78772,11232
78772,11817
79867,11817
79867,12626
80792,12626
80792,14062
81171,14062
81171,14424
82471,14424
82471,15055
83557,15055
83557,16158
84188,16158
84188,16772
85314,16772
85314,18188
85573,18188
85573,18598
86957,18598
86957,19899
87301,19899
87301,20942
87937,20942
87937,21902
88675,21902
88675,22692
89662,22692
89662,23972
89932,23972
89932,24741
90987,24741
90987,25832
91538,25832
91538,27127
91708,27127
91708,28094
92461,28094
92461,29086
93191,29086
93191,30203
93671,30203
93671,31293
94211,31293
94211,32525
94402,32525
94402,33715
94665,33715
94665,34739
95400,34739
95400,35775
96158,35775
96158,36914
96627,36914
96627,38153
96733,38153
96733,39465
96473,39465
96473,40509
97404,40509
97404,41858
96797,41858
96797,42955
97601,42955
97601,44214
97352,44214
97352,45389
97756,45389
97756,46601
97847,46601
97847,47809
98021,47809
98021,49037
97534,49037
97534,50245"""


print(q1(sample_input.splitlines()))
print(q1(real_input.splitlines()))

print(q2(sample_input.splitlines()))
print(q2(real_input.splitlines()))
